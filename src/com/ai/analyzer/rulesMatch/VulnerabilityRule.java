package com.ai.analyzer.rulesMatch;

import lombok.Data;
import java.util.List;
import java.util.Map;
import java.util.regex.Pattern;

/**
 * 漏洞匹配规则
 */
@Data
public class VulnerabilityRule {
    /**
     * 规则类型（sqli、xss、command_injection等）
     */
    private String type;
    
    /**
     * 漏洞名称
     */
    private String name;
    
    /**
     * 危险等级
     */
    private String severity;
    
    /**
     * 编译后的正则表达式模式（用于快速匹配）
     */
    private List<CompiledPattern> patterns;
    
    /**
     * 编译后的正则表达式模式包装类
     */
    @Data
    public static class CompiledPattern {
        private Pattern pattern;
        private String originalPattern;
        private String subType; // 例如：mysql、mssql、postgresql
        
        public CompiledPattern(String originalPattern, String subType) {
            this.originalPattern = originalPattern;
            this.subType = subType;
            try {
                // 编译正则表达式，忽略大小写
                this.pattern = Pattern.compile(originalPattern, Pattern.CASE_INSENSITIVE | Pattern.DOTALL);
            } catch (Exception e) {
                // 如果正则表达式无效，记录错误但不阻塞加载
                this.pattern = null;
            }
        }
        
        /**
         * 检查是否编译成功
         */
        public boolean isValid() {
            return pattern != null;
        }
    }
}
